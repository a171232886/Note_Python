

# 0. 前言

目标是替换`pip install git+URL`的方式，涉及修改hosts和pip从本地安装文件

# 1. Git 设置代理

1. 修改hosts文件只能解决国内DNS不提供github网址的问题，但github网址经常变换

2. 修改文件

   ```
   sudo vim /etc/hosts
   ```

   添加对应IP地址和网址，比如

   ```
   140.82.113.3      github.com
   ```

   修改后重启网络

   ```
   sudo /etc/init.d/networking restart
   ```

3. 一份关于Github的hosts

   来自：https://github.com/fliu2476/gh-hosts

   ```
   # Generated by Github Hosts start 
   
   185.199.109.154   github.githubassets.com
   140.82.114.22     central.github.com
   185.199.111.133   desktop.githubusercontent.com
   185.199.111.153   assets-cdn.github.com
   185.199.108.133   camo.githubusercontent.com
   185.199.108.133   github.map.fastly.net
   146.75.105.194    github.global.ssl.fastly.net
   140.82.113.3      gist.github.com
   185.199.108.153   github.io
   140.82.113.3      github.com
   140.82.113.5      api.github.com
   185.199.111.133   raw.githubusercontent.com
   185.199.108.133   user-images.githubusercontent.com
   185.199.108.133   favicons.githubusercontent.com
   185.199.108.133   avatars5.githubusercontent.com
   185.199.108.133   avatars4.githubusercontent.com
   185.199.108.133   avatars3.githubusercontent.com
   185.199.108.133   avatars2.githubusercontent.com
   185.199.110.133   avatars1.githubusercontent.com
   185.199.110.133   avatars0.githubusercontent.com
   185.199.111.133   avatars.githubusercontent.com
   140.82.114.9      codeload.github.com
   54.231.171.129    github-cloud.s3.amazonaws.com
   52.217.12.212     github-com.s3.amazonaws.com
   3.5.28.194        github-production-release-asset-2e65be.s3.amazonaws.com
   52.217.87.20      github-production-user-asset-6210df.s3.amazonaws.com
   54.231.167.113    github-production-repository-file-5c1aeb.s3.amazonaws.com
   185.199.110.153   githubstatus.com
   140.82.114.18     github.community
   185.199.108.133   media.githubusercontent.com
   
   # Last update: 5/30/2023, 4:15:46 PM
   # Please star: https://github.com/fliu2476/gh-hosts.git
   # Generated by Github Hosts end
   ```


# 2. pip

1. 测试环境：

   ```
   conda create -n t python=3.11
   conda activate t
   ```

2. pip官方：https://pip.pypa.io/en/latest/user_guide/

## 2.1 换源

1. 默认镜像源：https://pypi.python.org/simple

2. python国内的镜像源

   - 清华：https://pypi.tuna.tsinghua.edu.cn/simple
   - 阿里云：http://mirrors.aliyun.com/pypi/simple/

3. 临时更换

   ```
   pip install <package> -i https://pypi.python.org/simple
   ```

4. 永久更换

   ```
   pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
   ```



## 2.2 install的选项

1. 查看帮助

   ```
   pip install -h
   ```

2. 升级指定包，如pip

   ```
   pip install -U pip
   ```

3. 指定源

   ```
   pip install <package> -i https://pypi.tuna.tsinghua.edu.cn/simple
   ```

4. 本地安装，指定源码路径

   ```
   pip install -e <path>
   ```

   

## 2.3  安装本地代码

以PEFT为例

1. 下载代码，指定版本v0.2.0

   ```
   git clone -b v0.2.0 https://github.com/huggingface/peft.git
   ```

2. 进入并安装

   ```
   cd /home/dell/wh/download/peft
   pip install -e .
   ```


注：

1. 该方法等效于`pip install git+https://github.com/huggingface/peft@v0.2.0`
2. 上述方法通常连接超时



## 2.4 本地安装方式对比

https://stackoverflow.com/questions/30306099/pip-install-editable-vs-python-setup-py-develop

1. `pip install -e .`
   1. 自动下载包的所有依赖项
   
   2. 此种方式VSCode似乎无法找到函数定义
   
   3. 实际运行的是`/home/dell/wh/download/peft`文件夹下代码，而不是conda的env环境下代码
   
      
   
2. python setup.py install
   



# 3. 问题记录

1. pip无法安装旧版本torch

   ```
   pip install -f https://download.pytorch.org/whl/torch_stable.html torch==1.7.1+cu101 torchvision==0.8.2+cu101 torchaudio==0.7.2
   ```

   报错

   ```
   ERROR: Could not find a version that satisfies the requirement torch==1.7.1 (from versions: 1.13.0, 1.13.0+cpu, 1.13.0+cu116, 1.13.0+cu117, 1.13.0+cu117.with.pypi.cudnn, 1.13.1, 1.13.1+cpu, 1.13.1+cu116, 1.13.1+cu117, 1.13.1+cu117.with.pypi.cudnn, 2.0.0, 2.0.0+cpu, 2.0.0+cpu.cxx11.abi, 2.0.0+cu117, 2.0.0+cu117.with.pypi.cudnn, 2.0.0+cu118, 2.0.1, 2.0.1+cpu, 2.0.1+cpu.cxx11.abi, 2.0.1+cu117, 2.0.1+cu117.with.pypi.cudnn, 2.0.1+cu118, 2.0.1+rocm5.3, 2.0.1+rocm5.4.2)
   ERROR: No matching distribution found for torch==1.7.1
   ```

   解决：因为python版本过高，需要降低版本

   ```
   conda install python=3.8
   pip install -f https://download.pytorch.org/whl/torch_stable.html torch==1.7.1+cu101 torchvision==0.8.2+cu101 torchaudio==0.7.2
   ```

2. pytorch运行时表示缺少libcudnn.so或libcupti.so

   若为pip安装的，建议清除缓存（或使用其他版本）重新安装torch

3. 安装cudnn官网指导：https://docs.nvidia.com/deeplearning/cudnn/install-guide/index.html






# 参考

1. https://blog.csdn.net/weixin_43139128/article/details/120859861
2. https://pip.pypa.io/en/latest/user_guide/
3. https://pip.pypa.io/en/latest/user_guide/#installing-from-local-packages
4. https://numpy.org.cn/user/building.html